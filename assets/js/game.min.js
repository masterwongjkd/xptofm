function shuffleBoard(s) {
    var e = [],
        i = [],
        o;
    s || ($(".squares li.user").empty(), $(".squares li.user").each(function() {
        var s = $(this).attr("class").split(" ").pop();
        $(this).removeClass(s)
    }), selectedSquares = []), $(".settings input:checked").each(function() {
        var s = $(this).val();
        i.push(s), selectedSquares.push(allSquares[s])
    }), totalCategories = i.length, o = Math.ceil(totalUserSquares / totalCategories);
    for (var a = 0; a < totalCategories; a++) {
        for (var t = 1; t < allSquares[a].length; t++) allSquares[a][t].cat = allSquares[a][0].catName;
        for (var c = []; c.length < o;) {
            var n = getRandomNumber(1, selectedSquares[a].length);
            c.indexOf(n) > -1 || (c[c.length] = n)
        }
        for (var r = 0; r < c.length; r++) e.push(selectedSquares[a][c[r]])
    }
    e = shuffleArray(e);
    var g = 0;
    $(".squares li.user").each(function() {
        var s = $(this);
        if (s.hasClass("user")) {
            s.addClass(e[g].cat), s.data("tasktype", e[g].cat);
            var i = "<h2>" + e[g].cat + "</h2><img src='" + e[g].img + "' />";
            void 0 !== e[g].amount ? i += "<span>" + e[g].desc + "<small>" + randomiseAmount(e[g].amount) + "</small></span>" : i += "<span>" + e[g].desc + "</span>", s.append(i), g++
        }
    }), initChances()
}

function rollDice() {
    var s = 1,
        e = 6,
        i = 1e3,
        o = 3e3,
        a, t = $(".dice"),
        c = t.find("li");
    $(".dice-wrapper .label").addClass("hide"), zoomSquare(null, !1), hideChanceCard();
    var n = getRandomNumber(1e3, 3e3);
    t.addClass("rolling"), t.off("click");
    var r = setInterval(function() {
        a = getRandomNumber(1, 6), c.hide().eq(a - 1).show()
    }, diceSpeed);
    setTimeout(function() {
        clearInterval(r), movePlayer(a), t.removeClass("rolling"), t.on("click", rollDice)
    }, n)
}

function movePlayer(s) {
    var e = current + s,
        i, o, a = !1;
    e > 40 && (e -= 40), 3 != e && 8 != e && 18 != e && 23 != e && 29 != e && 34 != e && 37 != e && 39 != e || (a = !0);
    var t = $(".square#s" + e);
    if (i = t.position().left, o = t.position().top, current >= 1 && current <= 10 && e <= 11 && moveLeft(i, o, e, !0, a), current >= 1 && current <= 10 && e > 11 && (c = $(".square#s11").position().left, n = $(".square#s11").position().top, moveLeft(c, n, 11, !1, a), moveUp(i, o, e, !0, a)), current >= 11 && current <= 20 && e <= 21 && moveUp(i, o, e, !0, a), current >= 11 && current <= 20 && e > 21 && (c = $(".square#s21").position().left, n = $(".square#s21").position().top, moveUp(c, n, 21, !1, a), moveRight(i, o, e, !0, a)), 31 == e) {
        var c = $(".square#s1").position().left,
            n = $(".square#s1").position().top,
            r = $(".square#s11").position().left,
            g = $(".square#s11").position().top;
        moveDown(c, n, 1, !1), moveLeft(r, g, 11, !1), e = 11
    }
    current >= 21 && current <= 30 && e <= 30 && moveRight(i, o, e, !0, a), current >= 21 && current <= 30 && e > 31 && 30 !== e && (c = $(".square#s31").position().left, n = $(".square#s31").position().top, moveRight(c, n, 31, !1, a), moveDown(i, o, e, !0, a)), current >= 31 && current <= 40 && ((e > 31 || 1 == e) && moveDown(i, o, e, !0, a), e > 1 && e <= 10 && (c = $(".square#s1").position().left, n = $(".square#s1").position().top, moveDown(c, n, 1, !1), moveLeft(i, o, e, !0))), current = e
}

function moveLeft(s, e, i, o, a) {
    s += 11 == i ? cWidth / 2 - playerW / 2 : hSquareWidth / 2 - playerW / 2, e += hSquareHeight / 2 - playerH / 2, player.animate({
        left: s,
        top: e
    }, playerSpeed, function() {
        !a && o && zoomSquare($(".square#s" + i), !0), a && showChanceCard()
    })
}

function moveUp(s, e, i, o, a) {
    21 == i ? (s += cWidth / 2 - playerW / 2, e += cWidth / 2 - playerH / 2) : (s += vSquareWidth / 2 - playerW / 2, e += vSquareHeight / 2 - playerH / 2), player.animate({
        left: s,
        top: e
    }, playerSpeed, function() {
        !a && o && zoomSquare($(".square#s" + i), !0), a && showChanceCard()
    })
}

function moveRight(s, e, i, o, a) {
    s += 31 == i ? cWidth / 2 - playerW / 2 : hSquareWidth / 2 - playerW / 2, e += hSquareHeight / 2 - playerH / 2, player.animate({
        left: s,
        top: e
    }, playerSpeed, function() {
        !a && o && zoomSquare($(".square#s" + i), !0), a && showChanceCard()
    })
}

function moveDown(s, e, i, o, a) {
    1 == i ? (s += cWidth / 2 - playerW / 2, e += cWidth / 2 - playerH / 2) : (s += vSquareWidth / 2 - playerW / 2, e += vSquareHeight / 2 - playerH / 2), player.animate({
        left: s,
        top: e
    }, playerSpeed, function() {
        !a && o && zoomSquare($(".square#s" + i), !0), a && showChanceCard()
    })
}

function zoomSquare(s, e) {
    var i = $(".zoom");
    e ? (tasktype = s.data("tasktype"), $(".overlay").show().fadeTo(200, 1), chanceCard.css({
        zIndex: 99
    }), s.hasClass("corner") && i.addClass("corner"), w = 1.15 * i.width(), h = 1.15 * i.height(), $(i).addClass(tasktype).data("tasktype", tasktype).html(s.html()).append('<button class="btn-close-modal"></button>'), $(i).removeClass("hide").animate({
        width: w,
        height: h,
        opacity: 1
    }, 150)) : ($(".overlay").fadeTo(200, 0, function() {
        $(this).hide()
    }), i.hasClass("corner") ? (w = "20em", h = "20em") : (w = "20em", h = "30em"), $(i).addClass("hide").removeClass(tasktype).removeClass("corner").css({
        width: w,
        height: h
    }), chanceCard.css({
        zIndex: 102
    }))
}

function initChances() {
    var s;
    for (chances = [], chanceCard = $(".card-wrapper"), i = 0; i < totalCategories; i++)
        for (totalChances += selectedSquares[i].length - 1, j = 0; j <= selectedSquares[i].length - 1; j++) j > 0 && chances.push(selectedSquares[i][j])
}

function showChanceCard() {
    var s = chances[getChance()],
        e = s.desc;
    previousChance && previousChance == chances[i] && (s = chances[getChance()]), previousChance = chances[i], void 0 != s.amount && s.amount.indexOf("*") > -1 && (s.amount = randomiseAmount(s.amount), e += "<br><small> (" + s.amount + ")</small>"), $(".overlay").fadeTo(200, 1), chanceCard.find(".back").addClass(s.cat), chanceCard.find(".back .task").html(e), chanceCard.addClass("flipped"), chanceCard.find("h2").text(s.cat), chanceCard.find(".btn-close-modal").removeClass("hide").fadeTo(500, .5), $(document).on("click", hideChanceCard)
}

function hideChanceCard() {
    var s = $(".card-wrapper");
    s.removeClass("flipped"), s.find(".btn-close-modal").addClass("hide").fadeTo(0, 0), $(document).off("click", hideChanceCard)
}

function getChance() {
    var s = 0,
        e = chances.length;
    return i = getRandomNumber(0, e)
}

function getRandomNumber(s, e) {
    return Math.floor(Math.random() * (e - s) + s)
}

function resizeBoard() {
    board.css({
        width: board.height()
    })
}

function positionChanceCard() {
    var s = stack.offset().left + 12,
        e = stack.offset().top + 38;
    chanceCard.css({
        top: e,
        left: s
    })
}

function toggleSettingsPane() {
    $(".settings-msg").remove(), settingsPane.toggleClass("open closed")
}

function validateCheckboxes() {
    $("input[type='checkbox']:checked").length < 3 ? (alert("Please select at least 3 kinks"), $(this).prop("checked", !0)) : shuffleBoard()
}

function shuffleArray(s) {
    var e, i, o;
    for (o = s.length - 1; o > 0; o--) e = Math.floor(Math.random() * (o + 1)), i = s[o], s[o] = s[e], s[e] = i;
    return s
}

function randomiseAmount(s) {
    var e = getRandomNumber(minTime, maxTime);
    return s = s.replace("*", e), 1 == e && (s = s.substring(0, s.length - 1)), s
}

function initSettings() {
    settingsPane = $(".settings"), $(".btn-toggle-settings").on("click", toggleSettingsPane), $(".settings input[type=checkbox]").on("change", validateCheckboxes)
}

function initBoard() {
    board = $(".board"), player = $(".player"), chanceCard = $(".card-wrapper"), stack = $(".card-stack"), shuffleBoard(1), hSquareWidth = $(".square.top:not('.corner')").width(), hSquareHeight = $(".square.top:not('.corner')").height(), vSquareWidth = $(".square.left").width(), vSquareHeight = $(".square.left").height(), cWidth = $(".corner").width(), cHeight = $(".corner").height(), tasktype = $("#s1").data("tasktype"), positionChanceCard(), chanceCard.removeClass("hide"), playerW = player.width(), playerH = player.height();
    var s = $(".square#s1"),
        e = s.position().left + (cWidth / 2 - playerW / 2),
        i = s.position().top + (cHeight / 2 - playerH / 2);
    player.css({
        left: e,
        top: i
    }).addClass("on-corner").removeClass("hide"), $(".dice").on("click", rollDice), $("body").on("click", ".overlay, .btn-close-modal", function() {
        zoomSquare(null, !1)
    })
}
var allSquares = [
        [{
            catName: "humiliate"
        }, {
            desc: "Bra & Panties",
            img: "assets/icons/ico-bra-pants.svg"
        }, {
            desc: "Collar & Leash",
            img: "assets/icons/ico-collar.svg"
        }, {
            desc: "Verbal Abuse",
            img: "assets/icons/ico-mouth.svg"
        }, {
            desc: "Shave Pubes",
            img: "assets/icons/ico-razor.svg"
        }, {
            desc: "Wank on Video",
            img: "assets/icons/ico-video.svg"
        }, {
            desc: "Suck Dildo",
            img: "assets/icons/ico-dildo.svg"
        }, {
            desc: "Wear Makeup",
            img: "assets/icons/ico-makeup.svg"
        }, {
            desc: "Wear Dress",
            img: "assets/icons/ico-dress.svg"
        }, {
            desc: "Beg",
            img: "assets/icons/ico-begging.svg"
        }, {
            desc: "Sexy Dance",
            img: "assets/icons/ico-dance.svg"
        }, {
            desc: "Strapon Facefuck",
            img: "assets/icons/ico-dildo.svg"
        }],
        [{
            catName: "service"
        }, {
            desc: "Foot Massage",
            img: "assets/icons/ico-foot.svg"
        }, {
            desc: "Give Oral",
            img: "assets/icons/ico-mouth-tongue.svg"
        }, {
            desc: "Pleasure Her",
            img: "assets/icons/ico-vibrator.svg"
        }, {
            desc: "Her Choice",
            img: "assets/icons/ico-question.svg"
        }, {
            desc: "Her Choice",
            img: "assets/icons/ico-question.svg"
        }, {
            desc: "Body Massage",
            img: "assets/icons/ico-massage.svg"
        }, {
            desc: "Provide Orgasm",
            img: "assets/icons/ico-vibrator.svg"
        }, {
            desc: "Pet Her",
            img: "assets/icons/ico-massage.svg"
        }, {
            desc: "Paint Her Toes",
            img: "assets/icons/ico-foot.svg"
        }, {
            desc: "Suck Her Nipples",
            img: "assets/icons/ico-mouth.svg"
        }],
        [{
            catName: "bondage"
        }, {
            desc: "Blindfold",
            img: "assets/icons/ico-blindfold.svg"
        }, {
            desc: "Hogtie",
            img: "assets/icons/ico-gag.svg"
        }, {
            desc: "Balls Tied",
            img: "assets/icons/ico-rope.svg"
        }, {
            desc: "Spread Eagle",
            img: "assets/icons/ico-rope.svg"
        }, {
            desc: "Chair Tie",
            img: "assets/icons/ico-rope.svg"
        }, {
            desc: "Leap Frog",
            img: "assets/icons/ico-rope.svg"
        }, {
            desc: "Gag",
            img: "assets/icons/ico-gag.svg"
        }, {
            desc: "Hands Behind",
            img: "assets/icons/ico-rope.svg"
        }],
        [{
            catName: "toilet"
        }, {
            desc: "Golden Shower",
            img: "assets/icons/ico-goldenshower.svg"
        }, {
            desc: "Drink Piss",
            img: "assets/icons/ico-glass.svg"
        }, {
            desc: "Head Flush",
            img: "assets/icons/ico-toilet.svg"
        }, {
            desc: "Drink from Toilet",
            img: "assets/icons/ico-toilet.svg"
        }, {
            desc: "Clean with toothbrush",
            img: "assets/icons/ico-toilet.svg"
        }, {
            desc: "Piss on Face",
            img: "assets/icons/ico-goldenshower.svg"
        }, {
            desc: "Lick Clean",
            img: "assets/icons/ico-toilet.svg"
        }, {
            desc: "Eat used paper",
            img: "assets/icons/ico-toiletroll.svg"
        }, {
            desc: "Face in Toilet",
            amount: "* mins",
            img: "assets/icons/ico-toilet.svg"
        }],
        [{
            catName: "feet"
        }, {
            desc: "Suck Toes",
            img: "assets/icons/ico-foot.svg"
        }, {
            desc: "Kiss Feet",
            img: "assets/icons/ico-foot.svg"
        }, {
            desc: "Footstool",
            img: "assets/icons/ico-foot.svg"
        }, {
            desc: "Foot Massage",
            img: "assets/icons/ico-foot.svg"
        }, {
            desc: "Trampling",
            img: "assets/icons/ico-trample.svg"
        }, {
            desc: "Footjob",
            img: "assets/icons/ico-foot.svg"
        }, {
            desc: "Smell Feet",
            img: "assets/icons/ico-foot.svg"
        }, {
            desc: "Dirty Socks in Mouth",
            img: "assets/icons/ico-socks.svg"
        }],
        [{
            catName: "orgasm"
        }, {
            desc: "Edging",
            amount: "* mins",
            img: "assets/icons/ico-penis.svg"
        }, {
            desc: "Ruined Orgasm",
            img: "assets/icons/ico-penis.svg"
        }, {
            desc: "Denial",
            amount: "* days",
            img: "assets/icons/ico-padlock.svg"
        }, {
            desc: "Chastity",
            amount: "* mins",
            img: "assets/icons/ico-padlock.svg"
        }, {
            desc: "Masturbate",
            amount: "* mins",
            img: "assets/icons/ico-penis.svg"
        }, {
            desc: "Handjob",
            amount: "* mins",
            img: "assets/icons/ico-penis.svg"
        }, {
            desc: "Massage Balls",
            img: "assets/icons/ico-penis.svg"
        }],
        [{
            catName: "pet"
        }, {
            desc: "Drink from bowl",
            img: "assets/icons/ico-bowl.svg"
        }, {
            desc: "Bark",
            img: "assets/icons/ico-dog.svg"
        }, {
            desc: "Collar & Leash",
            img: "assets/icons/ico-collar.svg"
        }, {
            desc: "Piggy",
            img: "assets/icons/ico-piggy.svg"
        }, {
            desc: "Pony Ride",
            img: "assets/icons/ico-pony.svg"
        }, {
            desc: "Crawl",
            img: "assets/icons/ico-dog.svg"
        }, {
            desc: "Petting",
            img: "assets/icons/ico-dog.svg"
        }, {
            desc: "Tummy Rub",
            img: "assets/icons/ico-dog.svg"
        }],
        [{
            catName: "pain"
        }, {
            desc: "Face Slaps",
            amount: "* times",
            img: "assets/icons/ico-slap.svg"
        }, {
            desc: "Spanking",
            amount: "* times",
            img: "assets/icons/ico-slap.svg"
        }, {
            desc: "Whipping",
            amount: "* times",
            img: "assets/icons/ico-whip.svg"
        }, {
            desc: "Crop",
            amount: "* times",
            img: "assets/icons/ico-crop.svg"
        }, {
            desc: "Nipple Clamps",
            img: "assets/icons/ico-clothespeg.svg"
        }, {
            desc: "Flogging",
            amount: "* times",
            img: "assets/icons/ico-whip.svg"
        }],
        [{
            catName: "pain"
        }, {
            desc: "Cane",
            amount: "* times",
            img: "assets/icons/ico-cane.svg"
        }, {
            desc: "High Heel Trample",
            img: "assets/icons/ico-boot.svg"
        }, {
            desc: "Cock Trampling",
            img: "assets/icons/ico-penis.svg"
        }, {
            desc: "Whipping",
            amount: "* times",
            img: "assets/icons/ico-whip.svg"
        }, {
            desc: "Flogging",
            amount: "* times",
            img: "assets/icons/ico-whip.svg"
        }],
        [{
            catName: "anal"
        }, {
            desc: "Pegging (soft)",
            img: "assets/icons/ico-dildo.svg"
        }, {
            desc: "Butt Plug",
            amount: "* mins",
            img: "assets/icons/ico-buttplug.svg"
        }, {
            desc: "Prostate Massage",
            img: "assets/icons/ico-vibrator.svg"
        }, {
            desc: "Anal Fingering",
            img: "assets/icons/ico-finger.svg"
        }, {
            desc: "Suck Dildo Clean",
            img: "assets/icons/ico-dildo.svg"
        }, {
            desc: "Fuck your ass",
            img: "assets/icons/ico-dildo.svg"
        }, {
            desc: "Pegging (hard)",
            img: "assets/icons/ico-dildo.svg"
        }, {
            desc: "Finger your Ass",
            img: "assets/icons/ico-finger.svg"
        }]
    ],
    player, playerW, playerH, playerSpeed = 500,
    board, diceSpeed = 75,
    totalUserSquares = 24,
    selectedSquares = [],
    hSquareWidth, hSquareHeight, vSquareWidth, vSquareHeight, cWidth, cHeight, current = 1,
    tasktype, chanceCard, stack, previousChance = !1,
    totalChances = 0,
    chances = [],
    settingsPane, totalCategories, minTime = 5,
    maxTime = 15;
$(document).ready(function() {
    initSettings(), initBoard(), $(document).on("keypress", function(s) {
        13 !== s.keyCode && 27 !== s.keyCode || (zoomSquare(null, !1), hideChanceCard())
    })
}), $(window).resize(function() {
    positionChanceCard()
});